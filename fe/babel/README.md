# ä»€ä¹ˆæ˜¯babel
babelæ˜¯ä¸€ä¸ªJavaScriptç¼–è¯‘å™¨ï¼Œ

# babel-cli
babel-cliåªæ˜¯ä½¿ç”¨babelçš„ä¸€ç§æ–¹å¼ï¼Œå› ä¸ºæœ‰çš„é¡¹ç›®ä¸å¤ªå¤§ï¼Œç”¨ä¸åˆ°webpackç­‰æ„å»ºå·¥å…·ï¼Œæ‰€ä»¥åœ¨å‘å¸ƒä¹‹å‰ä½¿ç”¨babel-cliå³å¯ã€‚
## åŸºæœ¬ç”¨æ³•
```shell
  $ npm install -g babel-cli
```
ç„¶åå¯ä»¥å°†æŸä¸ªæ–‡ä»¶ç¼–è¯‘åè¾“å‡ºï¼š
```shell
  $ babel index.js --out-file index.js
  # ç®€å†™ä¸º
  $ babel index.js -o index.js
  # å¦‚æœæƒ³è¦è¾“å‡ºåˆ°æŸä¸ªæ–°çš„ç›®å½•
  $ babel src --out-dir lib
  # æˆ–è€…ç®€å†™ä¸º
  $ babel src -d lib
```

## æœ¬åœ°å®‰è£…
```shell
  $ npm install -D babel-cli
```
ç„¶åå¯ä»¥ä½¿ç”¨`./node_modules/.bin/babel`å‘½ä»¤è¿è¡Œå³å¯ã€‚

å¦‚æœå«Œå¤ªéº»çƒ¦ï¼Œå¯ä»¥ç›´æ¥å†™åˆ°`package.json`çš„scriptså­—æ®µä¸­ï¼š
```json
  {
    "start": "./node_modules/.bin/babel src -d lib"
  }
```

# babel-core
æœ‰è®¸å¤šåœ¨çº¿babelè½¬è¯‘çš„ç½‘ç«™ï¼Œè¿™ä¸ªå°±æ˜¯ç”¨babel-coreåšåˆ°çš„ï¼š
```javascript
  const babel = require('babel-core');
  const code = `
    class Foo {
      constructor(props) {
        console.log(1)
      }
    }
  `;
  // å…¶ä»–é…ç½®æ–‡æ¡£å¾ˆæ¸…æ¥šï¼Œè¿™é‡Œåªä¸¾ä¸ªæ —å­
  const result = babel.transform(code, {
    code: true, // ç”Ÿæˆä»£ç 
    presets: [],  // è¿™ä¸ªå’Œ.babelrcæ–‡ä»¶é‡Œé¢çš„presetsä¸€æ ·ï¼Œå…·ä½“è¯·çœ‹ä¸‹æ–‡
    plugins: [], // åŒä¸Š
  })ï¼›
  console.log(result.code);
  // ç»“æœå°±æ˜¯è½¬è¯‘åçš„code
```
> å¯ä»¥çœ‹åˆ°ï¼Œæ¯”èµ·ä¸Šé¢çš„`babel-cli`ï¼Œ`babel-code`æä¾›äº†ä½¿ç”¨ç¼–ç¨‹å¼çš„è½¬è¯‘åŠŸèƒ½.

è¿˜å¯ä»¥å¯¹æ–‡ä»¶è¿›è¡Œè½¬è¯‘ï¼š
```javascript
babel.transformFile(filename, options, (err, result) => {
  //
});
```
> è¿˜æœ‰å…¶ä»–ä¸€äº›ä¸œä¸œï¼Œå…·ä½“çœ‹[æ–‡æ¡£](https://www.babeljs.cn/docs/core-packages/#options)å»ğŸ™ƒã€‚

# è¯´å¥½çš„è½¬è¯‘å‘¢ï¼Ÿ
é€šè¿‡ä¸Šé¢å‡ éƒ¨ï¼Œä¼šå‘ç°ï¼Œéƒ½åªæ˜¯å°†ä»£ç åŸå°ä¸åŠ¨çš„æŒªäº†ä¸ªåœ°å„¿ã€‚ä¸æ˜¯è¯´å¯ä»¥è½¬è¯‘ä¹ˆã€‚

> å› ä¸º`babel`ä¸€é€šè¿‡å„ç§èŠ±æ ·å»ç©å„¿çš„ç¼–è¯‘å™¨ï¼Œä½†æ˜¯é»˜è®¤æƒ…å†µä¸‹å®ƒåè€Œçƒéƒ½ä¸å¹²ã€‚æ‰€æœ‰å°±éœ€è¦å¯¹`babel`è¿›è¡Œé…ç½®ï¼Œä¹Ÿå°±æ˜¯çœ¼ç†Ÿçš„`.babelrc`æ–‡ä»¶ã€‚

## .babelrc
åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹åˆ›å»º`.babelrc`æ–‡ä»¶ï¼Œç„¶åè¿›è¡Œé…ç½®ï¼š
```json
{
  "presets": [],
  "plugins": [],
}
```
> `.babelrc`åªæ˜¯é…ç½®babelçš„ä¸€ç§æ–¹å¼ï¼Œä¹Ÿå¯ä»¥é€šè¿‡å…¶ä»–æ–¹å¼ç»™babelä¼ é€’å‚æ•°ï¼Œä½†æ˜¯`.babelrc`æ˜¯çº¦å®šçš„æœ€å¥½æ–¹å¼ã€‚

> è¿˜å¯ä»¥å°†è¿™ä¸ªæ–‡ä»¶çš„å†…å®¹å†™åœ¨`package.json`çš„`babel`å­—æ®µä¸­ï¼š
```json
{
  "babel": {
    "presets": [],
    "plugins": [],
  }
}
```

### æŸ¥æ‰¾
`Babel` ä¼šåœ¨æ­£åœ¨è¢«è½¬å½•çš„æ–‡ä»¶çš„å½“å‰ç›®å½•ä¸­æŸ¥æ‰¾ä¸€ä¸ª `.babelrc` æ–‡ä»¶ã€‚ å¦‚æœä¸å­˜åœ¨ï¼Œå®ƒä¼šéå†ç›®å½•æ ‘ï¼Œç›´åˆ°æ‰¾åˆ°ä¸€ä¸ª `.babelrc` æ–‡ä»¶ï¼Œæˆ–ä¸€ä¸ª `package.json` æ–‡ä»¶ä¸­æœ‰ `"babel": {}` ã€‚

åœ¨é€‰é¡¹ä¸­ä½¿ç”¨ `"babelrc": false` æ¥åœæ­¢æŸ¥æ‰¾è¡Œä¸ºï¼Œæˆ–è€…æä¾›`--no-babelrc CLI` æ ‡å¿—ã€‚

## ç°åœ¨è¯¥è¯´æ€ä¹ˆè½¬è¯‘äº†
é€šè¿‡ä½¿ç”¨`babel-preset-es2015`å°±å¯ä»¥å°†ES2015+çš„è¯­æ³•è½¬è¯‘ä¸ºES5äº†ï¼š
```shell
$ npm install -D babel-preset-es2015
```
```json
{
  "presets": [
    "es2015"
  ]
}
```
è¿™ä¸‹ä»€ä¹ˆç®­å¤´å‡½æ•°ã€letã€constå°±éƒ½è¢«è½¬è¯‘ä¸ºES5å¯¹åº”çš„åŒç­‰åŠŸèƒ½çš„è¯­æ³•äº†ã€‚

## babel-polyfill
æ‰§è¡Œäº†ä¸Šé¢çš„æ“ä½œä¼šå‘ç°ï¼Œåªæœ‰ES2015+çš„è¯­æ³•è¢«è½¬è¯‘äº†ï¼Œå…¶ä»–æ–°çš„APIè¿˜æ˜¯åŸå°ä¸åŠ¨ã€‚æ˜¯ä¸æ˜¯æœ‰ç§è¢«éª—çš„æ„Ÿè§‰ï¼Œæˆ‘éƒ½æ”¯æŒAPIäº†ï¼Œè¯­æ³•èƒ½ä¸ä¼šï¼ŸQNMLGBã€‚ã€‚

æ‰€ä»¥è¿˜éœ€è¦ä¸€ä¸ªä¸œä¸œï¼š`babel-polyfill`
```shell
$ npm install --save babel-polyfill
```
> çœ‹ä»”ç»†ï¼Œæ˜¯saveï¼Œä¸æ˜¯save-devã€‚å› ä¸ºè¿™æ˜¯ä¸€ä¸ª polyfill ï¼ˆå®ƒéœ€è¦åœ¨ä½ çš„æºä»£ç ä¹‹å‰è¿è¡Œï¼‰ï¼Œæˆ‘ä»¬éœ€è¦è®©å®ƒæˆä¸ºä¸€ä¸ª dependency, è€Œä¸æ˜¯ä¸€ä¸ª devDependency.

æ¥ä¸‹æ¥åªéœ€è¦åœ¨ä½¿ç”¨åˆ°æ–°APIçš„æ–‡ä»¶é¡¶éƒ¨å¼•å…¥å®ƒå°±å¯ä»¥äº†ã€‚
```javascript
import 'babel-polyfill';
```
`babel-polyfill`çš„ä¸¤ä¸ªä¸»è¦ç¼ºç‚¹ï¼š
1. ä½¿ç”¨`babel-polyfill`ä¼šå¯¼è‡´æ‰“å‡ºæ¥çš„åŒ…éå¸¸å¤§ï¼Œå› ä¸º`babel-polyfill`æ˜¯ä¸€ä¸ªæ•´ä½“ï¼Œå®ƒæŠŠæ‰€æœ‰çš„é™æ€æ–¹æ³•éƒ½åŠ åˆ°äº†åŸå‹é“¾ä¸Š(ä¹ŸåŒ…æ‹¬æ²¡æœ‰ç”¨åˆ°çš„æ–¹æ³•)ï¼Œè¿™ä¸ªé—®é¢˜å¯ä»¥é€šè¿‡ä½¿ç”¨`core-js`çš„æŸä¸ªç±»åº“æ¥è§£å†³ï¼Œ`core-js`éƒ½æ˜¯åˆ†å¼€çš„ã€‚
2. `babel-polyfill`ä¼šæ±¡æŸ“å…¨å±€ç¯å¢ƒï¼Œå› ä¸ºå®ƒå¯¹è®¸å¤šç±»çš„åŸå‹éƒ½åšäº†ä¿®æ”¹ã€‚

## babel-plugin-transform-runtime
åœ¨ä¸ä½¿ç”¨è¿™ä¸ªæ’ä»¶çš„æ—¶å€™ï¼Œæ¯ä¸ªæ–‡ä»¶æ‰€ç”¨åˆ°çš„å…¬å…±æ–¹æ³•éƒ½ä¼šç”Ÿæˆä¸€æ¬¡ï¼Œè€Œä½¿ç”¨ä¹‹åå°±ä¼šå°†è¿™äº›å…¬å…±æ–¹æ³•æ”¾åˆ°ä¸€ä¸ªæ–‡ä»¶ï¼Œç„¶åæ¯ä¸ªæ–‡ä»¶`require`å°±å¯ä»¥äº†ã€‚

ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ä¸ªæ’ä»¶æŠŠé‡å¤å®šä¹‰å˜ä¸ºé‡å¤å¼•ç”¨ï¼Œè§£å†³äº†ä»£ç é‡å¤é—®é¢˜ã€‚
> ä½†æ˜¯å®ƒä¸æ”¯æŒå®ä¾‹æ–¹æ³•ï¼Œæ¯”å¦‚ï¼š`[].includes();`ï¼Œè€Œä¸”å®ƒéœ€è¦`babel-runtime`ä½œä¸ºä¾èµ–ã€‚`babel-plugin-transform-runtime`æ˜¯æŒ‰éœ€å¼•å…¥é™æ€æ–¹æ³•ï¼Œå¯¹äºå®ä¾‹ä¸Šçš„æ–¹æ³•æ˜¯æ— èƒ½ä¸ºåŠ›çš„ï¼Œè§£å†³åŠæ³•æ˜¯ï¼š`babel-polyfill`æˆ–`babel-preset-env`,æ¨èåè€…ï¼Œå¼€å¯useBuiltInsã€‚

### babel-runtimeå’Œbabel-plugin-transform-runtimeçš„åŒºåˆ«
ä¹‹å‰ä¸€ç›´é”™è¯¯çš„ä»¥ä¸ºbabel-runtimeä¹Ÿæ˜¯ä¸€ä¸ªpluginï¼Œç°åœ¨å‘ç°babel-runtimeåªæ˜¯ä¸€ä¸ªåº“ï¼Œä¸€ä¸ªæ¨¡å—ï¼Œå¦‚æœç¯å¢ƒä¸æ”¯æŒPromiseï¼Œå¯ä»¥åœ¨é¡¹ç›®ä¸­åŠ å…¥ï¼š
```js
require('@babel/runtime/core-js/promise');
```

è€Œ`babel-plugin-transform-runtime`çš„å·¥ä½œå°±æ˜¯åˆ¤æ–­æ–‡ä»¶éœ€è¦å¼•å…¥`core-js`ä¸­çš„å“ªä¸ªï¼Œå¹¶å¼•å…¥å…¶éœ€è¦çš„æ–¹æ³•åº“ã€‚



## preset
å› ä¸º`es2015`æ˜¯ä¸€å¥—è§„èŒƒï¼ŒåŒ…å«å‡ åä¸ªè½¬è¯‘æ’ä»¶ï¼Œå¦‚æœéœ€è¦ä¸€ä¸ªä¸ªæ·»åŠ å®‰è£…ï¼Œé‚£é…ç½®æ–‡ä»¶å°±æ²¡æ³•çœ‹äº†ï¼Œè€Œä¸”ä¸‹è½½æ—¶é—´ä¹Ÿæ¯”è¾ƒé•¿ã€‚

æ‰€ä»¥`babel`æä¾›äº†ä¸€ç»„æ’ä»¶é›†åˆã€‚

`preset`åˆ†ä¸ºä»¥ä¸‹å‡ ç§ï¼š
1. å®˜æ–¹å†…å®¹: `env, react, flow, minify`ç­‰
2. `stage-x`, æ¯å¹´æ›´æ–°ï¼Œæ˜¯å½“å¹´çš„æœ€æ–°è§„èŒƒè‰æ¡ˆï¼Œç»†åˆ†ä¸º:
    1. stage0-ç¨»è‰äººï¼šåªæ˜¯ä¸€ä¸ªideaï¼Œç»è¿‡TC39æˆå‘˜æå‡ºå³å¯ã€‚
    2. stage1-ææ¡ˆï¼šåˆæ­¥å°è¯•
    3. stage2-åˆç¨¿ï¼šå®Œæˆåˆæ­¥è§„èŒƒ
    4. å®Œæˆï¼Œè¢«æ·»åŠ åˆ°ä¸‹ä¸€å¹´å‘å¸ƒã€‚
3. `es2015+`, `latest`: å·²ç»çº³å…¥æ ‡å‡†è§„èŒƒä¸­çš„è¯­æ³•ã€‚`latest`çš„`env`çš„å‡ºè¡Œï¼Œä»–æ˜¯æ¯å¹´æ›´æ–°çš„`preset`ï¼Œç›®çš„æ˜¯åŒ…å«æ‰€æœ‰çš„`2015+`ï¼Œä½†æ˜¯æ›´åŠ çµæ´»çš„`env`çš„å‡ºç°ï¼Œç°åœ¨å®ƒå·²ç»åºŸå¼ƒã€‚

## æ’ä»¶å’Œpresetçš„é…ç½®
é€šå¸¸æƒ…å†µä¸‹ï¼Œåªéœ€è¦åˆ—å‡ºå­—ç¬¦ä¸²æ ¼å¼çš„åå­—å³å¯ã€‚å¦‚æœæŸä¸ªpresetæˆ–pluginéœ€è¦ä¸€äº›é…ç½®ï¼Œé‚£å°±éœ€è¦å°†è¯¥é¡¹æ”¹ä¸ºæ•°ç»„ã€‚

+ ç¬¬ä¸€ä¸ªå…ƒç´ ï¼šè¡¨ç¤ºè‡ªå·±åå­—çš„string
+ ç¬¬äºŒä¸ªå…ƒç´ ï¼šä¸€ä¸ªé…ç½®å¯¹è±¡
```json
{
  "presets": [
    [
      "env",
      {
        "module": false,
      }
    ],
    "stage-0",
  ]
}
```

## env
æœ€å¸¸ç”¨ï¼Œä¹Ÿæœ€é‡è¦ã€‚

`env`çš„æ ¸å¿ƒç›®çš„æ˜¯é€šè¿‡é…ç½®å¾—çŸ¥ç›®æ ‡ç¯å¢ƒï¼Œç„¶ååªåšå¿…è¦çš„è½¬æ¢ã€‚å¦‚æœä¸å†™ä»»ä½•é…ç½®ï¼Œ`env`ç­‰äº`latest`ï¼Œå°±æ˜¯`es2015+`çš„æ‰€æœ‰é›†åˆï¼ˆä¸åŒ…æ‹¬`stage`ï¼‰ã€‚

envç¤ºä¾‹é…ç½®ï¼š
```js
{
  "presets": [
    [
      "env",
      {
        "targets": {
          // å¦‚æœæ˜¯æµè§ˆå™¨çš„æœ€æ–°2ä¸ªç‰ˆæœ¬æˆ–è€…safari7.0+ï¼Œåˆ™ä¸åšè½¬æ¢
          "browser": ["last 2 versions", "safari >= 7"]
        },
        "useBuiltIns": false, // é»˜è®¤ä¸ºfalseï¼Œå…·ä½“åŠŸèƒ½çœ‹ä¸‹é¢
      }
    ]
  ]
}
```
è¿˜å¯ä»¥æ˜¯`node`ç¯å¢ƒ
```js
{
  "presets": [
    [
      "env",
      {
        "targets": {
          "node": "6.10", // currentæ˜¯æœ€æ–°ç¨³å®šç‰ˆ
        }
      }
    ]
  ]
}
```
ä¸Šé¢æåˆ°ä¸€ä¸ªå‚æ•°`useBuiltIns`,è¿™ä¸ªå‚æ•°æ„æ€æ˜¯ï¼šæ˜¯å¦ä¸ºæ¯ä¸ªæ–‡ä»¶è‡ªåŠ¨æ·»åŠ æ’ä»¶å…¼å®¹ï¼Œæˆ–è€…æŠŠ`import "@babel/polyfill"`æ ¹ç»ä¸åŒç›®æ ‡ç¯å¢ƒæ‹†åˆ†ä¸ºå¤šä¸ªå…¼å®¹æ’ä»¶ã€‚å¦‚ï¼š
```js
import '@babel/polyfill';
```
æ ¹æ®ä¸åŒçš„ç¯å¢ƒï¼Œè¾“å‡ºï¼š
```js
import "core-js/modules/es7.string.pad-start";
import "core-js/modules/es7.string.pad-end";
```

è¿™ä¸ªå‚æ•°åœ¨`babel6`ä¸­åªæœ‰`trueã€false`,åœ¨`babel7`ä¸­å–å€¼ä¸ºï¼š`"usage"|"entry"|false`,é»˜è®¤ä¸º`false`<br>è¯¦ç»†é…ç½®è¯·çœ‹ï¼šhttps://babeljs.io/docs/en/babel-preset-env#usebuiltins

#æ‰§è¡Œé¡ºåº
+ `plugin`ä¼šè¿è¡Œåœ¨`preset`ä¹‹å‰
+ `plugin`ä¼šä»å‰åˆ°åæ‰§è¡Œ(å’Œ`webpack`çš„`loader`ç›¸å)
+ `preset`çš„æ‰§è¡Œé¡ºåºæ˜¯ä»åå‘å‰ï¼Œå’Œ`webpack`çš„`loader`ç›¸åŒã€‚
> `preset`çš„é€†å‘é¡ºåºæ˜¯ä¸ºäº†ä¿è¯å‘åå…¼å®¹ï¼Œå› ä¸ºå¤§å¤šæ•°çš„ç¼–å†™é¡ºåºæ˜¯`['es2015', 'stage-0']`


# å‚è€ƒ
`babel`çš„æ–‡æ¡£å†™çš„æˆ‘æ„Ÿè§‰æ˜¯çœŸçš„æœ‰ç‚¹æ“ã€‚ä¸‹é¢æ˜¯ä¸€äº›æˆ‘æ¯”è¾ƒå–œæ¬¢çš„æ–‡ç« ï¼š

[Babel ç”¨æˆ·æ‰‹å†Œ](https://blog.csdn.net/sinat_34056695/article/details/74452558)

[ä¸€å£(å¾ˆé•¿çš„)æ°”äº†è§£ babel](https://juejin.im/post/5c19c5e0e51d4502a232c1c6)

[æ·±å…¥Babelï¼Œè¿™ä¸€ç¯‡å°±å¤Ÿäº†](https://juejin.im/post/5c21b584e51d4548ac6f6c99)

[click me to fuck babel](https://github.com/jamiebuilds/babel-handbook/blob/master/translations/zh-Hans/README.md)