# ä»€ä¹ˆæ˜¯babel
babelæ˜¯ä¸€ä¸ªJavaScriptç¼–è¯‘å™¨ï¼Œ


# babel-cli
babel-cliåªæ˜¯ä½¿ç”¨babelçš„ä¸€ç§æ–¹å¼ï¼Œå› ä¸ºæœ‰çš„é¡¹ç›®ä¸å¤ªå¤§ï¼Œç”¨ä¸åˆ°webpackç­‰æ„å»ºå·¥å…·ï¼Œæ‰€ä»¥åœ¨å‘å¸ƒä¹‹å‰ä½¿ç”¨babel-cliå³å¯ã€‚
## åŸºæœ¬ç”¨æ³•
```shell
  $ npm install -g babel-cli
```
ç„¶åå¯ä»¥å°†æŸä¸ªæ–‡ä»¶ç¼–è¯‘åè¾“å‡ºï¼š
```shell
  $ bbabel index.js --out-file index.js
  # ç®€å†™ä¸º
  $ babel index.js -o index.js
  # å¦‚æœæƒ³è¦è¾“å‡ºåˆ°æŸä¸ªæ–°çš„ç›®å½•
  $ babel src --out-dir lib
  # æˆ–è€…ç®€å†™ä¸º
  $ babel src -d lib
```

## æœ¬åœ°å®‰è£…
```shell
  $ npm install -D babel-cli
```
ç„¶åå¯ä»¥ä½¿ç”¨`./node_modules/.bin/babel`å‘½ä»¤è¿è¡Œå³å¯ã€‚

å¦‚æœå«Œå¤ªéº»çƒ¦ï¼Œå¯ä»¥ç›´æ¥å†™åˆ°`package.json`çš„scriptså­—æ®µä¸­ï¼š
```json
  {
    "start": "./node_modules/.bin/babel src -d lib"
  }
```

# babel-core
æœ‰è®¸å¤šåœ¨çº¿babelè½¬è¯‘çš„ç½‘ç«™ï¼Œè¿™ä¸ªå°±æ˜¯ç”¨babel-coreåšåˆ°çš„ï¼š
```javascript
  const babel = require('babel-core');
  const code = `
    class Foo {
      constructor(props) {
        console.log(1)
      }
    }
  `;
  // å…¶ä»–é…ç½®æ–‡æ¡£å¾ˆæ¸…æ¥šï¼Œè¿™é‡Œåªä¸¾ä¸ªæ —å­
  const result = babel.transform(code, {
    code: true, // ç”Ÿæˆä»£ç 
    presets: [],  // è¿™ä¸ªå’Œ.babelrcæ–‡ä»¶é‡Œé¢çš„presetsä¸€æ ·ï¼Œå…·ä½“è¯·çœ‹ä¸‹æ–‡
    plugins: [], // åŒä¸Š
  })ï¼›
  console.log(result.code);
  // ç»“æœå°±æ˜¯è½¬è¯‘åçš„code
```
> å¯ä»¥çœ‹åˆ°ï¼Œæ¯”èµ·ä¸Šé¢çš„`babel-cli`ï¼Œ`babel-code`æä¾›äº†ä½¿ç”¨ç¼–ç¨‹å¼çš„è½¬è¯‘åŠŸèƒ½.

è¿˜å¯ä»¥å¯¹æ–‡ä»¶è¿›è¡Œè½¬è¯‘ï¼š
```javascript
babel.transformFile(filename, options, (err, result) => {
  //
});
```
> è¿˜æœ‰å…¶ä»–ä¸€äº›ä¸œä¸œï¼Œå…·ä½“çœ‹[æ–‡æ¡£](https://www.babeljs.cn/docs/core-packages/#options)å»ğŸ™ƒã€‚

# è¯´å¥½çš„è½¬è¯‘å‘¢ï¼Ÿ
é€šè¿‡ä¸Šé¢å‡ éƒ¨ï¼Œä¼šå‘ç°ï¼Œéƒ½åªæ˜¯å°†ä»£ç åŸå°ä¸åŠ¨çš„æŒªäº†ä¸ªåœ°å„¿ã€‚ä¸æ˜¯è¯´å¯ä»¥è½¬è¯‘ä¹ˆã€‚

> å› ä¸º`babel`ä¸€é€šè¿‡å„ç§èŠ±æ ·å»ç©å„¿çš„ç¼–è¯‘å™¨ï¼Œä½†æ˜¯é»˜è®¤æƒ…å†µä¸‹å®ƒåè€Œçƒéƒ½ä¸å¹²ã€‚æ‰€æœ‰å°±éœ€è¦å¯¹`babel`è¿›è¡Œé…ç½®ï¼Œä¹Ÿå°±æ˜¯çœ¼ç†Ÿçš„`.babelrc`æ–‡ä»¶ã€‚

## .babelrc
åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹åˆ›å»º`.babelrc`æ–‡ä»¶ï¼Œç„¶åè¿›è¡Œé…ç½®ï¼š
```json
{
  "presets": [],
  "plugins": [],
}
```
> `.babelrc`åªæ˜¯é…ç½®babelçš„ä¸€ç§æ–¹å¼ï¼Œä¹Ÿå¯ä»¥é€šè¿‡å…¶ä»–æ–¹å¼ç»™babelä¼ é€’å‚æ•°ï¼Œä½†æ˜¯`.babelrc`æ˜¯çº¦å®šçš„æœ€å¥½æ–¹å¼ã€‚

> è¿˜å¯ä»¥å°†è¿™ä¸ªæ–‡ä»¶çš„å†…å®¹å†™åœ¨`package.json`çš„`babel`å­—æ®µä¸­ï¼š
```json
{
  "babel": {
    "presets": [],
    "plugins": [],
  }
}
```

### æŸ¥æ‰¾
`Babel` ä¼šåœ¨æ­£åœ¨è¢«è½¬å½•çš„æ–‡ä»¶çš„å½“å‰ç›®å½•ä¸­æŸ¥æ‰¾ä¸€ä¸ª `.babelrc` æ–‡ä»¶ã€‚ å¦‚æœä¸å­˜åœ¨ï¼Œå®ƒä¼šéå†ç›®å½•æ ‘ï¼Œç›´åˆ°æ‰¾åˆ°ä¸€ä¸ª `.babelrc` æ–‡ä»¶ï¼Œæˆ–ä¸€ä¸ª `package.json` æ–‡ä»¶ä¸­æœ‰ `"babel": {}` ã€‚

åœ¨é€‰é¡¹ä¸­ä½¿ç”¨ `"babelrc": false` æ¥åœæ­¢æŸ¥æ‰¾è¡Œä¸ºï¼Œæˆ–è€…æä¾›`--no-babelrc CLI` æ ‡å¿—ã€‚

## ç°åœ¨è¯¥è¯´æ€ä¹ˆè½¬è¯‘äº†
é€šè¿‡ä½¿ç”¨`babel-preset-es2015`å°±å¯ä»¥å°†ES2015+çš„è¯­æ³•è½¬è¯‘ä¸ºES5äº†ï¼š
```shell
$ npm install -D babel-preset-es2015
```
```json
{
  "presets": [
    "es2015"
  ]
}
```
è¿™ä¸‹ä»€ä¹ˆç®­å¤´å‡½æ•°ã€letã€constå°±éƒ½è¢«è½¬è¯‘ä¸ºES5å¯¹åº”çš„åŒç­‰åŠŸèƒ½çš„è¯­æ³•äº†ã€‚

## babel-polyfill
æ‰§è¡Œäº†ä¸Šé¢çš„æ“ä½œä¼šå‘ç°ï¼Œåªæœ‰ES2015+çš„è¯­æ³•è¢«è½¬è¯‘äº†ï¼Œå…¶ä»–æ–°çš„APIè¿˜æ˜¯åŸå°ä¸åŠ¨ã€‚æ˜¯ä¸æ˜¯æœ‰ç§è¢«éª—çš„æ„Ÿè§‰ï¼Œæˆ‘éƒ½æ”¯æŒAPIäº†ï¼Œè¯­æ³•èƒ½ä¸ä¼šï¼ŸQNMLGBã€‚ã€‚

æ‰€ä»¥è¿˜éœ€è¦ä¸€ä¸ªä¸œä¸œï¼š`babel-polyfill`
```shell
$ npm install --save babel-polyfill
```
> çœ‹ä»”ç»†ï¼Œæ˜¯saveï¼Œä¸æ˜¯save-devã€‚å› ä¸ºè¿™æ˜¯ä¸€ä¸ª polyfill ï¼ˆå®ƒéœ€è¦åœ¨ä½ çš„æºä»£ç ä¹‹å‰è¿è¡Œï¼‰ï¼Œæˆ‘ä»¬éœ€è¦è®©å®ƒæˆä¸ºä¸€ä¸ª dependency, è€Œä¸æ˜¯ä¸€ä¸ª devDependency.

æ¥ä¸‹æ¥åªéœ€è¦åœ¨ä½¿ç”¨åˆ°æ–°APIçš„æ–‡ä»¶é¡¶éƒ¨å¼•å…¥å®ƒå°±å¯ä»¥äº†ã€‚
```javascript
import 'babel-polyfill';
```

## babel-runtime
babelä¼šä½¿ç”¨åŠ©æ‰‹æ–¹æ³•æ¥ä¿æŒç”Ÿæˆä»£ç çš„ç—‡ç»“ã€‚ä½†æ˜¯è¿™äº›æ–¹æ³•å¯èƒ½ä¼šç‰¹åˆ«é•¿ï¼Œè€Œä¸”è¢«æ·»åŠ åˆ°æ¯ä¸€ä¸ªæ–‡ä»¶é¡¶éƒ¨ï¼Œå› æ­¤ä½ å¯ä»¥æŠŠä»–ä»¬åŒæ„ç§»åŠ¨åˆ°ä¸€ä¸ªå•ä¸€çš„`run time`ä¸­å»ã€‚

ç„¶ååœ¨`.babelrc`ä¸­è¿›è¡Œé…ç½®å³å¯ï¼š
```javascript
{
  "plugins": [
    "transform-runtime",
  ]
}
```

#preset
å› ä¸ºes2015æ˜¯ä¸€å¥—è§„èŒƒï¼ŒåŒ…å«å‡ åä¸ªè½¬è¯‘æ’ä»¶ï¼Œå¦‚æœéœ€è¦ä¸€ä¸ªä¸ªæ·»åŠ å®‰è£…ï¼Œé‚£é…ç½®æ–‡ä»¶å°±æ²¡æ³•çœ‹äº†ï¼Œè€Œä¸”ä¸‹è½½æ—¶é—´ä¹Ÿæ¯”è¾ƒé•¿ã€‚

æ‰€ä»¥babelæä¾›äº†ä¸€ç»„æ’ä»¶é›†åˆã€‚

presetåˆ†ä¸ºä»¥ä¸‹å‡ ç§ï¼š
1. å®˜æ–¹å†…å®¹: `env, react, flow, minify`ç­‰
2. stage-x, æ¯å¹´æ›´æ–°ï¼Œæ˜¯å½“å¹´çš„æœ€æ–°è§„èŒƒè‰æ¡ˆï¼Œç»†åˆ†ä¸º:
    1. stage0-ç¨»è‰äººï¼šåªæ˜¯ä¸€ä¸ªideaï¼Œç»è¿‡TC39æˆå‘˜æå‡ºå³å¯ã€‚
    2. stage1-ææ¡ˆï¼šåˆæ­¥å°è¯•
    3. stage2-åˆç¨¿ï¼šå®Œæˆåˆæ­¥è§„èŒƒ
    4. å®Œæˆï¼Œè¢«æ·»åŠ åˆ°ä¸‹ä¸€å¹´å‘å¸ƒã€‚
3. es2015+, latest: å·²ç»çº³å…¥æ ‡å‡†è§„èŒƒä¸­çš„è¯­æ³•ã€‚latestçš„envçš„å‡ºè¡Œï¼Œä»–æ˜¯æ¯å¹´æ›´æ–°çš„presetï¼Œç›®çš„æ˜¯åŒ…å«æ‰€æœ‰çš„2015+ï¼Œä½†æ˜¯æ›´åŠ çµæ´»çš„envçš„å‡ºç°ï¼Œç°åœ¨å®ƒå·²ç»åºŸå¼ƒã€‚

## æ’ä»¶å’Œpresetçš„é…ç½®
é€šå¸¸æƒ…å†µä¸‹ï¼Œåªéœ€è¦åˆ—å‡ºå­—ç¬¦ä¸²æ ¼å¼çš„åå­—å³å¯ã€‚å¦‚æœæŸä¸ªpresetæˆ–pluginéœ€è¦ä¸€äº›é…ç½®ï¼Œé‚£å°±éœ€è¦å°†è¯¥é¡¹æ”¹ä¸ºæ•°ç»„ã€‚

+ ç¬¬ä¸€ä¸ªå…ƒç´ ï¼šè¡¨ç¤ºè‡ªå·±åå­—çš„string
+ ç¬¬äºŒä¸ªå…ƒç´ ï¼šä¸€ä¸ªé…ç½®å¯¹è±¡
```json
{
  "presets": [
    [
      "env",
      {
        "module": false,
      }
    ],
    "stage-0",
  ]
}
```

# env
æœ€å¸¸ç”¨ï¼Œä¹Ÿæœ€é‡è¦ã€‚

envçš„æ ¸å¿ƒç›®çš„æ˜¯é€šè¿‡é…ç½®å¾—çŸ¥ç›®æ ‡ç¯å¢ƒï¼Œç„¶ååªåšå¿…è¦çš„è½¬æ¢ã€‚å¦‚æœä¸å†™ä»»ä½•é…ç½®ï¼Œenvç­‰äºlatestï¼Œå°±æ˜¯es2015+çš„æ‰€æœ‰é›†åˆï¼ˆä¸åŒ…æ‹¬stageï¼‰ã€‚

envç¤ºä¾‹é…ç½®ï¼š
```json
{
  "presets": [
    [
      "env",
      {
        "targets": {
          // å¦‚æœæ˜¯æµè§ˆå™¨çš„æœ€æ–°2ä¸ªç‰ˆæœ¬æˆ–è€…safari7.0+ï¼Œåˆ™ä¸åšè½¬æ¢
          "browser": ["last 2 versions", "safari >= 7"]
        }
      }
    ]
  ]
}
```
è¿˜å¯ä»¥æ˜¯nodeç¯å¢ƒ
```json
{
  "presets": [
    [
      "env",
      {
        "targets": {
          "node": "6.10", // currentæ˜¯æœ€æ–°ç¨³å®šç‰ˆ
        }
      }
    ]
  ]
}
```

#æ‰§è¡Œé¡ºåº
+ pluginä¼šè¿è¡Œåœ¨presetä¹‹å‰
+ pluginä¼šä»å‰åˆ°åæ‰§è¡Œ(å’Œwebpackçš„loaderç›¸å)
+ presetçš„æ‰§è¡Œé¡ºåºæ˜¯ä»åå‘å‰ï¼Œå’Œwebpackçš„loaderç›¸åŒã€‚
> presetçš„é€†å‘é¡ºåºæ˜¯ä¸ºäº†ä¿è¯å‘åå…¼å®¹ï¼Œå› ä¸ºå¤§å¤šæ•°çš„ç¼–å†™é¡ºåºæ˜¯`['es2015', 'stage-0']`


# å‚è€ƒ
babelçš„æ–‡æ¡£å†™çš„æˆ‘æ„Ÿè§‰æ˜¯çœŸçš„æœ‰ç‚¹æ“ã€‚ä¸‹é¢æ˜¯ä¸€äº›æˆ‘æ¯”è¾ƒå–œæ¬¢çš„æ–‡ç« ï¼š

[Babel ç”¨æˆ·æ‰‹å†Œ](https://blog.csdn.net/sinat_34056695/article/details/74452558)